/*! laygridder 23-08-2018 */

var LGLocation=new Marionette.Application;LGLocation.addRegions({mainRegion:"#locationmanager"}),LGLocation.on("start",function(){LGLocation.trigger("manager:show")}),LGLocation.module("Entities",function(e,t,i,o,n,l){e.API={getJSONObject:function(){return c()},updateJSON:function(){a()}};var a=function(){var e=t.Row.API.getView().collection.toJSON(),i=window.JSON.stringify(e,void 0,2);n("#lg_locations_json").val(i)},c=function(){var e=n.trim(n("#lg_locations_json").val());if(void 0!==e&&""!=e)return JSON.parse(e)}}),LGLocation.module("LocationApp",function(e,t,i,o,n,l){t.on("manager:show",function(){t.module("Manager").API.showManager()})}),LGLocation.module("Manager",function(e,t,i,o,n,l){e.API={showManager:function(){a()}};var a=function(){t.Row.API.initCollection();var e=t.Row.API.initView();t.mainRegion.show(e)}}),LGLocation.module("Row",function(e,t,i,o,n,l){var a=new i.Collection,c=null;e.API={addRow:function(){d()},deleteRow:function(e){s(e)},initCollection:function(){return r()},initView:function(){return h()},getView:function(){return c}};var d=function(){var e=new i.Model({type:"post_type",val:"post",hide_editor:!1});c.collection.add(e),t.Entities.API.updateJSON()},s=function(e){c.collection.remove(e),t.Entities.API.updateJSON()},r=function(){var e=t.Entities.API.getJSONObject();return void 0!==e&&a.add(e),a},h=function(){return c=new t.Row.Rows({collection:a})}}),LGLocation.module("Row",function(e,t,i,o,n,l){e.Row=o.ItemView.extend({template:"#row-select-view",tagName:"tr",events:{"change #lg-type-select":"changeType","change .lg-location-select":"changeVal","change .lg-location-hide-editor":"changeHideEditor","click .js-delete-location":"deleteRow"},changeHideEditor:function(e){n(e.target).is(":checked")?this.model.set("hide_editor",!0):this.model.set("hide_editor",!1),t.Entities.API.updateJSON()},changeVal:function(e){var i=n(e.target).val();this.model.set("val",i),t.Entities.API.updateJSON()},maybeDisableHideEditorCheckbox:function(){var e=this.model.get("type",e);"tax_term"==e?this.$el.find(".lg-location-hide-editor").removeAttr("checked").attr("disabled","disabled"):this.$el.find(".lg-location-hide-editor").removeAttr("disabled")},changeType:function(){var e=this.$el.find("#lg-type-select").val();this.model.set("type",e),this.$el.find(".lg-location-select").hide(),this.$el.find(".lg-location-select#lg-"+e).show();var i=this.$el.find(".lg-location-select#lg-"+e).val();this.model.set("val",i),this.maybeDisableHideEditorCheckbox(),t.Entities.API.updateJSON()},initSelectFields:function(){var e=this.model.get("type"),t=this.model.get("val"),i=this.model.get("hide_editor");this.$el.find("#lg-type-select").val(e),this.$el.find(".lg-location-select").hide(),this.$el.find(".lg-location-select#lg-"+e).val(t).show(),1==i&&this.$el.find(".lg-location-hide-editor").attr("checked","checked")},deleteRow:function(i){e.API.deleteRow(this.model),t.Entities.API.updateJSON()},onRender:function(){var e=this;setTimeout(function(){e.initSelectFields(),e.maybeDisableHideEditorCheckbox()},0)}}),e.Rows=o.CompositeView.extend({tagName:"div",template:"#row-composite-view",childViewContainer:".js-locations-table-tbody",childView:e.Row,events:{"click .js-add-location":"addRow"},addRow:function(t){t.preventDefault(),e.API.addRow()}})});